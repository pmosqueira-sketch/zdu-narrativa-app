<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>ZDU · Content Audit</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0e1117; --panel:#151923; --panel-2:#1c1f26; --ink:#d8dee9;
      --muted:#8b93a1; --hi:#33ccff; --ok:#00ff99; --warn:#ffcc66; --fail:#ff667a;
      --card:#0f141c; --chip:#0d1117; --border:rgba(255,255,255,.08);
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    header{position:sticky;top:0;z-index:10;background:linear-gradient(180deg,var(--panel) 0%,rgba(21,25,35,.85) 100%);
      border-bottom:2px solid var(--ok);padding:12px 18px}
    h1{margin:0;font-size:18px;color:var(--hi)}
    main{padding:20px}
    section{background:var(--panel-2);border-radius:12px;padding:16px;margin-bottom:20px;box-shadow:0 0 0 1px rgba(255,255,255,.04) inset}
    section h2{margin:0 0 8px;color:var(--ok);font-size:16px}
    section p.lead{margin:0 0 10px;color:var(--muted)}
    table{width:100%;border-collapse:collapse;font-size:13px}
    th,td{padding:6px 8px;border-bottom:1px solid var(--border);text-align:left}
    th{color:var(--ok);font-weight:600}
    tr:hover{background:rgba(255,255,255,0.02)}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:2px 8px;border-radius:999px;background:var(--chip);border:1px solid var(--border);color:var(--muted);font-size:12px}
    .ok{color:var(--ok)} .warn{color:var(--warn)} .fail{color:var(--fail)}
    footer{padding:14px 20px;color:var(--muted);text-align:center}
    /* NAV */
    nav{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0 0}
    nav a{color:#b9c6d6;text-decoration:none;padding:6px 10px;border:1px solid var(--border);border-radius:8px;background:var(--chip)}
    nav a:hover{border-color:#2a2f3a}
    nav a.active{background:#0b0f14;color:var(--ok);border-color:#214436}
    nav a.master{font-weight:700}
    /* skeleton */
    .skeleton{background:linear-gradient(90deg,#10151c 0%,#111822 50%,#10151c 100%);background-size:200% 100%;animation:sh 1.1s infinite;border-radius:8px;height:120px}
    @keyframes sh{0%{background-position:0 0}100%{background-position:-200% 0}}
  </style>
</head>
<body>
  <header>
    <h1>ZDU · Content Audit</h1>
    <nav>
      <a class="master" href="./index.html" title="Consola Maestra (Home)">Home</a>
      <a href="./devsecops.html">DevSecOps</a>
      <a class="active" aria-current="page" href="./content.html">Content Audit</a>
      <a href="./security.html">Security Posture</a>
      <a href="./campaigns.html">QMA-C360</a>
      <a href="./protocols.html">Protocols</a>
    </nav>
  </header>

  <main>
    <section>
      <h2>Inventario de Contenidos</h2>
      <p class="lead">Listado de archivos auditados (fuente: <span class="pill">content_audit.json</span>).</p>
      <div style="overflow-x:auto">
        <table id="contentTable">
          <thead>
            <tr>
              <th>Ruta</th>
              <th>Tipo</th>
              <th>Propósito</th>
              <th>Owner</th>
              <th>Tamaño (KB)</th>
              <th>Últ. Modif.</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr><td colspan="7">Cargando…</td></tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <footer>
    ZDU QUALITY SYSTEM · Content Audit · v2
  </footer>

  <script>
    const LOGS = '/private/infra/scripts/logs/';
    const PATH_CONTENT = LOGS + 'content_audit.json';

    const $ = (s)=>document.querySelector(s);
    async function j(url){ const r = await fetch(url, {cache:'no-store'}); if(!r.ok) throw new Error(`${r.status} ${url}`); return r.json(); }

    function renderContent(rows){
      const tbody = $('#contentTable tbody');
      if(!Array.isArray(rows) || !rows.length){
        tbody.innerHTML = `<tr><td colspan="7">Sin datos</td></tr>`;
        return;
      }
      tbody.innerHTML = rows.map(r => `
        <tr>
          <td>${r.path}</td>
          <td>${r.kind||''}</td>
          <td>${r.purpose||''}</td>
          <td>${r.owner||''}</td>
          <td>${(r.size_kb||0).toFixed(1)}</td>
          <td>${new Date(r.last_modified).toLocaleString()}</td>
          <td class="${r.status}">${r.status}</td>
        </tr>`).join('');
    }

    (async ()=>{
      try{
        const data = await j(PATH_CONTENT);
        renderContent(data);
      }catch(e){
        $('#contentTable tbody').innerHTML = `<tr><td colspan="7" class="fail">Error: ${e.message}</td></tr>`;
      }
    })();
  </script>
</body>
</html>